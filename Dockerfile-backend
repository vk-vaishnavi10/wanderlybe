# ===============================
# üß± Stage 1 ‚Äî Build the Spring Boot JAR using Maven
# ===============================
FROM maven:3.9.5-eclipse-temurin-17 AS build
WORKDIR /app

# 1Ô∏è‚É£ Copy only pom.xml first to leverage Docker caching
COPY pom.xml .

# 2Ô∏è‚É£ Pre-download dependencies (avoids rebuilding every time)
RUN mvn dependency:go-offline -B

# 3Ô∏è‚É£ Copy source and build
COPY src ./src
RUN mvn clean package -DskipTests

# ===============================
# üöÄ Stage 2 ‚Äî Run the Spring Boot app
# ===============================
FROM eclipse-temurin:21-jdk
WORKDIR /app

# ‚úÖ Copy the built JAR from previous stage
COPY --from=build /app/target/*.jar app.jar

# ‚úÖ Use port 8085 (as in your docker-compose.yml)
EXPOSE 8085

ENTRYPOINT ["java", "-jar", "app.jar"]
